!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).lazyframe=t()}(this,(function(){"use strict";return(()=>{const e=new RegExp(/^(?:https?:\/\/)?(?:www\.)?(youtube-nocookie|youtube|vimeo)(?:\.com)?\/?.*(?:watch|embed)?(?:.*v=|v\/|\/)([\w-_]+)(?:\&|\?|\/\?)?(.+)?$/),t="lazyframe--loaded",n="lazyframe__title",i=[];let o={debounce:100,lazyload:!0,autoplay:!0,onLoad:()=>{},onAppend:()=>{},onThumbnailLoad:()=>{}};function l(l){if(l.classList.contains(t))return;const r=Object.assign(Object.assign({},function(t){const n=t.getAttribute("data-src"),i=t.getAttribute("data-title"),l=t.getAttribute("data-thumbnail"),a="true"===t.getAttribute("data-initinview");if(!n)throw new Error("You must supply a data-src on the node");const[,r,d,c]=n.match(e)||[],s=r||null;s&&("youtube-nocookie"===s?t.setAttribute("data-vendor","youtube"):t.setAttribute("data-vendor",s));const f=`autoplay=${o.autoplay?1:0}${c?"&"+c:""}`;return{src:n,title:i,thumbnail:l,initinview:a,id:d,vendor:s,embed:n,useApi:!(!s||i&&l),query:f,initialized:!1,iframeNode:u(s,f,n,d)}}(l)),{node:l}),d=function(e){const t=document.createDocumentFragment(),i=document.createElement("span");i.className=n,t.appendChild(i),e.title&&(i.innerHTML=e.title);return e.node.appendChild(t),t}(r);r.node.appendChild(d),r.node.addEventListener("click",(function(){r.node.appendChild(r.iframeNode),o.onAppend.call(null,l.querySelector("iframe"))}),{once:!0}),i.push(r),o.lazyload||a(r)}function a(e){e.useApi?function(e){return fetch(`https://noembed.com/embed?url=${e.src}`).then((e=>e.json())).then((t=>(t.title&&(e.title=t.title),t.thumbnail_url&&(e.thumbnail=t.thumbnail_url),e)))}(e).then(r):r(e)}function r(e){const n=e.node.querySelector(".lazyframe__title");e.title&&n&&""===n.innerHTML&&(n.innerHTML=e.title),e.thumbnail&&(e.node.style.backgroundImage=`url(${e.thumbnail})`,o.onThumbnailLoad.call(null,e.thumbnail)),function(e){e.node.classList.add(t),e.initialized=!0,e.initinview&&e.node.click();o.onLoad.call(null,e.node)}(e)}function u(e="",t,n,i){const l=document.createDocumentFragment(),a=document.createElement("iframe");let r=n;return e&&e.indexOf("youtube")>-1?r=`https://www.${e}.com/embed/${i}/?${t}`:"vimeo"===e&&(r=`https://player.vimeo.com/video/${i}/?${t}`),i&&a.setAttribute("id",`lazyframe-${i}`),a.setAttribute("src",r),a.setAttribute("frameborder","0"),a.setAttribute("allowfullscreen",""),o.autoplay&&(a.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"),l.appendChild(a),l}return function(e,t){o=Object.assign(Object.assign({},o),t);const n="string"==typeof e?document.querySelectorAll(e):e instanceof NodeList?e:[e];for(const e of n)e instanceof HTMLElement&&l(e);return o.lazyload&&function(){i.filter((({node:e})=>e.offsetTop<window.innerHeight)).forEach(a);let e=0;const t=function(e,t){let n;return function(){let i=()=>{n=null,e.apply(null)},o=!n;n&&clearTimeout(n),n=setTimeout(i,t),o&&e.apply(null)}}((()=>{const n=e<window.pageYOffset;e=window.pageYOffset,n&&i.filter((({initialized:e})=>!1===e)).filter((({node:t})=>t.offsetTop<window.innerHeight+e)).forEach(a),i.filter((({initialized:e})=>!1===e)).length<1&&window.removeEventListener("scroll",t,!1)}),o.debounce);window.addEventListener("scroll",t,!1)}(),i}})()}));